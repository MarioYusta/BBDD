--EJERCICIO 5_2--

CREATE TABLE DEPARTAMENTO(
CLAVE_DEPTO NUMBER(1) CONSTRAINT PK_DEPTO PRIMARY KEY,
NOMBRE VARCHAR(30) NOT NULL,
PRESUPUESTO NUMBER(5) NOT NULL
);

CREATE TABLE EMPLEADOS(
CLAVE_EMPLEADO VARCHAR(5) CONSTRAINT PK_EMPLEADOS PRIMARY KEY,
NOMBRE VARCHAR(30) NOT NULL,
APELLIDOS VARCHAR(30) NOT NULL,
CLAVE_DEPTO NUMBER(1) NOT NULL,
CONSTRAINT FK_DEPTO FOREIGN KEY (CLAVE_DEPTO) REFERENCES DEPARTAMENTO(CLAVE_DEPTO)
);

INSERT INTO DEPARTAMENTO (CLAVE_DEPTO, NOMBRE, PRESUPUESTO)VALUES(1, 'PERSONAL', 80000);
INSERT INTO DEPARTAMENTO (CLAVE_DEPTO, NOMBRE, PRESUPUESTO)VALUES(2, 'ALMACEN', 70000);
INSERT INTO DEPARTAMENTO (CLAVE_DEPTO, NOMBRE, PRESUPUESTO)VALUES(3, 'CONTABILIDAD', 60000);
INSERT INTO DEPARTAMENTO (CLAVE_DEPTO, NOMBRE, PRESUPUESTO)VALUES(4, 'MANUFACTURA', 50000);
INSERT INTO DEPARTAMENTO (CLAVE_DEPTO, NOMBRE, PRESUPUESTO)VALUES(5, 'EMPAQUE', 30000);

INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP01', 'ARMANDO', 'LOPEZ', 2);    
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP02', 'TATIANA', 'VARGAS', 1);
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP03', 'LAURA', 'GARCIA', 3);
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP04', 'JUAN', 'PEREZ', 4);
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP05', 'IVAN', 'LOPEZ', 4);
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP06', 'MARGARITA', 'HERNADEZ', 1);
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP07', 'JESUS', 'PEREZ', 3);
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP08', 'TOÃ‘O', 'FLORES', 2);
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP09', 'JUAN', 'LOPEZ', 4);
INSERT INTO EMPLEADOS (CLAVE_EMPLEADO, NOMBRE, APELLIDOS, CLAVE_DEPTO)VALUES('EMP10', 'JOSE', 'HERNADEZ', 5);

SELECT NOMBRE, APELLIDOS FROM EMPLEADOS

SELECT DISTINCT APELLIDOS FROM EMPLEADOS 

SELECT * FROM EMPLEADOS
WHERE APELLIDOS = 'LOPEZ'

SELECT EMPLEADOS.NOMBRE, EMPLEADOS.APELLIDOS, DEPARTAMENTO.NOMBRE FROM EMPLEADOS, DEPARTAMENTO
WHERE EMPLEADOS.NOMBRE LIKE ('%A')
AND EMPLEADOS.CLAVE_DEPTO = DEPARTAMENTO.CLAVE_DEPTO

SELECT * FROM EMPLEADOS
WHERE APELLIDOS = 'LOPEZ'
OR APELLIDOS = 'PEREZ'

SELECT NOMBRE, CLAVE_EMPLEADO FROM EMPLEADOS
WHERE CLAVE_DEPTO = 4

SELECT NOMBRE, APELLIDOS FROM EMPLEADOS
WHERE APELLIDOS LIKE 'H%'

SELECT * FROM DEPARTAMENTO
WHERE PRESUPUESTO BETWEEN 50000 AND 70000

SELECT EMPLEADOS.NOMBRE, APELLIDOS, CLAVE_EMPLEADO FROM EMPLEADOS, DEPARTAMENTO
WHERE DEPARTAMENTO.NOMBRE = 'CONTABILIDAD'
AND DEPARTAMENTO.CLAVE_DEPTO = EMPLEADOS.CLAVE_DEPTO

SELECT EMPLEADOS.NOMBRE, APELLIDOS, DEPARTAMENTO.NOMBRE FROM EMPLEADOS, DEPARTAMENTO
WHERE EMPLEADOS.CLAVE_DEPTO = DEPARTAMENTO.CLAVE_DEPTO

SELECT AVG(DEPARTAMENTO.PRESUPUESTO)/10 FROM DEPARTAMENTO, EMPLEADOS

SELECT COUNT(*) FROM EMPLEADOS, DEPARTAMENTO
WHERE EMPLEADOS.NOMBRE LIKE 'J%'
AND DEPARTAMENTO.CLAVE_DEPTO = EMPLEADOS.CLAVE_DEPTO
AND DEPARTAMENTO.NOMBRE = 'MANUFACTURA'

--EJERCICIO 5_3--

CREATE TABLE PRODUCTO(
CODPRODUCTO NUMBER(5) NOT NULL,
NOMBRE VARCHAR2(40) NOT NULL,
TIPO VARCHAR2(2) NOT NULL,
PRECIOCOSTE NUMBER(5,2) NOT NULL,
PRECIOVENTA NUMBER(5,2) NOT NULL,
IVA NUMBER(2) NOT NULL,
CONSTRAINT pk_PRODUCTO PRIMARY KEY (CODPRODUCTO)
);

CREATE TABLE LINEAVENTA(
CODPRODUCTO NUMBER(5) NOT NULL,
CODVENTA NUMBER(5) NOT NULL,
CANTIDAD NUMBER(2) NOT NULL,
CONSTRAINT pk_lineaventa PRIMARY KEY(CODPRODUCTO,CODVENTA),
CONSTRAINT fk_lineaventa FOREIGN KEY (CODVENTA) REFERENCES VENTA(CODVENTA),
CONSTRAINT fk_linea FOREIGN KEY(CODPRODUCTO) REFERENCES PRODUCTO(CODPRODUCTO)
);

CREATE TABLE VENTA(
CODVENTA NUMBER(5) NOT NULL,
FECHA DATE NOT NULL,
CONSTRAINT pk_VENTA PRIMARY KEY(CODVENTA));

INSERT INTO VENTA (CODVENTA, FECHA)VALUES(10000, '21/01/2023');
INSERT INTO VENTA (CODVENTA, FECHA)VALUES(10001, '25/02/2023');
INSERT INTO VENTA (CODVENTA, FECHA)VALUES(10002, '16/03/2023');
INSERT INTO VENTA (CODVENTA, FECHA)VALUES(10005, '01/01/2023');
INSERT INTO VENTA (CODVENTA, FECHA)VALUES(10010, '23/02/2023');

INSERT INTO PRODUCTO (CODPRODUCTO, NOMBRE, TIPO, PRECIOCOSTE, PRECIOVENTA, IVA)VALUES(50000, 'QUESO', 'L', 10.52, 25.63, 10);
INSERT INTO PRODUCTO (CODPRODUCTO, NOMBRE, TIPO, PRECIOCOSTE, PRECIOVENTA, IVA)VALUES(50005, 'LECHE', 'L', 10.56, 12.55, 4);
INSERT INTO PRODUCTO (CODPRODUCTO, NOMBRE, TIPO, PRECIOCOSTE, PRECIOVENTA, IVA)VALUES(50010, 'HUEVOS', 'H', 26.03, 35.20, 10);
INSERT INTO PRODUCTO (CODPRODUCTO, NOMBRE, TIPO, PRECIOCOSTE, PRECIOVENTA, IVA)VALUES(50015, 'CARNE POLLO', 'C', 11.20, 40.90, 2);
INSERT INTO PRODUCTO (CODPRODUCTO, NOMBRE, TIPO, PRECIOCOSTE, PRECIOVENTA, IVA)VALUES(50020, 'CARNE TERNERA', 'C', 50.79, 64.52, 4);
INSERT INTO PRODUCTO (CODPRODUCTO, NOMBRE, TIPO, PRECIOCOSTE, PRECIOVENTA, IVA)VALUES(50025, 'YOGURT', 'L', 2.56, 7.55, 10);
INSERT INTO PRODUCTO (CODPRODUCTO, NOMBRE, TIPO, PRECIOCOSTE, PRECIOVENTA, IVA)VALUES(50030, 'JUDIAS', 'V', 18.90, 20.00, 4);

INSERT INTO LINEAVENTA (CODPRODUCTO, CODVENTA, CANTIDAD)VALUES(50000, 10000, 2);
INSERT INTO LINEAVENTA (CODPRODUCTO, CODVENTA, CANTIDAD)VALUES(50005, 10001, 5);
INSERT INTO LINEAVENTA (CODPRODUCTO, CODVENTA, CANTIDAD)VALUES(50010, 10002, 10);
INSERT INTO LINEAVENTA (CODPRODUCTO, CODVENTA, CANTIDAD)VALUES(50015, 10005, 11);
INSERT INTO LINEAVENTA (CODPRODUCTO, CODVENTA, CANTIDAD)VALUES(50020, 10010, 9);

--------------------------------
-- EJERCICIO 5_3 --

--A
SELECT COUNT(PRECIOCOSTE) FROM PRODUCTO
WHERE PRECIOCOSTE < (PRECIOVENTA / 2)
--B
SELECT MAX(PRECIOVENTA), MAX(PRECIOCOSTE) FROM PRODUCTO
WHERE IVA = 10
--C
SELECT MIN(PRECIOVENTA) FROM PRODUCTO
--D
SELECT COUNT(PRECIOCOSTE) FROM PRODUCTO
WHERE TIPO = 'C'
AND PRECIOCOSTE < (PRECIOVENTA / 3)
--E
SELECT SUM((PRECIOVENTA - PRECIOCOSTE)* CANTIDAD) FROM PRODUCTO, LINEAVENTA
WHERE TIPO = 'L'
AND LINEAVENTA.CODPRODUCTO = PRODUCTO.CODPRODUCTO
--F
SELECT AVG((PRECIOVENTA - PRECIOCOSTE)*CANTIDAD) FROM PRODUCTO, LINEAVENTA
WHERE TIPO IN('L', 'C', 'V', 'H')
AND LINEAVENTA.CODPRODUCTO = PRODUCTO.CODPRODUCTO
--G
SELECT ROUND(PRECIOCOSTE,1) , ROUND(PRECIOVENTA,1) FROM PRODUCTO
WHERE NOMBRE LIKE 'L%'
--H
SELECT ROUND(PRECIOVENTA,1) FROM PRODUCTO
WHERE PRECIOVENTA > (PRECIOCOSTE + (PRECIOCOSTE * 0.20))
--I
SELECT MOD(PRECIOVENTA, PRECIOCOSTE) FROM PRODUCTO
WHERE IVA IN(4, 10)
--J
SELECT COUNT (*) FROM VENTA
--K
SELECT LOWER(NOMBRE) FROM PRODUCTO
WHERE TIPO = 'L'